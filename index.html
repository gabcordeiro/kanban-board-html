<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quadro Kanban Interativo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            color: #333;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        h1 {
            color: #2c3e50;
            font-size: 2.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .controls {
            display: flex;
            gap: 12px;
        }

        button {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
            box-shadow: 0 4px 15px rgba(46, 204, 113, 0.3);
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(46, 204, 113, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
        }

        .kanban-board {
            display: flex;
            gap: 25px;
            overflow-x: auto;
            padding: 15px 5px;
            min-height: 600px;
        }

        .column {
            min-width: 320px;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            max-height: 80vh;
            backdrop-filter: blur(10px);
            transition: transform 0.3s ease;
        }

        .column:hover {
            transform: translateY(-5px);
        }

        .column-header {
            padding: 20px;
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        .column-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .column-actions {
            display: flex;
            gap: 8px;
        }

        .column-actions button {
            padding: 6px 12px;
            font-size: 0.85rem;
        }

        .cards-container {
            padding: 15px;
            flex-grow: 1;
            overflow-y: auto;
            min-height: 200px;
            transition: background-color 0.3s;
        }

        .cards-container.drag-over {
            background-color: rgba(102, 126, 234, 0.1);
            border: 2px dashed #667eea;
            border-radius: 8px;
        }

        .card {
            background-color: #fff;
            border-radius: 10px;
            padding: 16px;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            cursor: grab;
            position: relative;
            transition: all 0.3s ease;
            border-left: 5px solid #3498db;
        }

        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.12);
        }

        .card.dragging {
            opacity: 0.6;
            transform: rotate(5deg);
            cursor: grabbing;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .card-title {
            font-weight: bold;
            font-size: 1.1rem;
            flex-grow: 1;
            margin-right: 10px;
            color: #2c3e50;
        }

        .card-actions {
            display: flex;
            gap: 6px;
        }

        .card-actions button {
            padding: 4px 8px;
            font-size: 0.75rem;
        }

        .card-content {
            font-size: 0.95rem;
            line-height: 1.5;
            color: #555;
        }

        .add-card-btn {
            margin: 15px;
            padding: 12px;
            background: linear-gradient(135deg, #ecf0f1, #bdc3c7);
            border: 2px dashed #95a5a6;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            color: #7f8c8d;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .add-card-btn:hover {
            background: linear-gradient(135deg, #d5dbdb, #a6acaf);
            transform: translateY(-2px);
        }

        .add-column-btn {
            min-width: 320px;
            padding: 25px;
            background: linear-gradient(135deg, rgba(255,255,255,0.8), rgba(236, 240, 241, 0.8));
            border: 3px dashed #bdc3c7;
            border-radius: 12px;
            cursor: pointer;
            text-align: center;
            color: #7f8c8d;
            font-weight: bold;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            backdrop-filter: blur(10px);
        }

        .add-column-btn:hover {
            background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(213, 219, 219, 0.9));
            transform: translateY(-3px);
            border-color: #95a5a6;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: linear-gradient(135deg, #fff, #f8f9fa);
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }

        .modal-title {
            font-size: 1.4rem;
            font-weight: bold;
            color: #2c3e50;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: #7f8c8d;
            transition: color 0.3s;
        }

        .close-modal:hover {
            color: #e74c3c;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        input, textarea, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        textarea {
            min-height: 120px;
            resize: vertical;
        }

        .color-picker {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .color-picker input {
            width: 60px;
            height: 50px;
            padding: 0;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }

        .emoji-selector {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .emoji-option {
            font-size: 1.4rem;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.2s;
            background: #f8f9fa;
        }

        .emoji-option:hover {
            background: #3498db;
            transform: scale(1.1);
        }

        .file-input {
            display: none;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #7f8c8d;
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            display: block;
        }

        /* Scrollbar personalizada */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìã Quadro Kanban Interativo</h1>
            <div class="controls">
                <button class="btn-primary" id="exportBtn">
                    <span>üíæ</span> Exportar JSON
                </button>
                <button class="btn-success" id="importBtn">
                    <span>üì•</span> Importar JSON
                </button>
                <input type="file" id="fileInput" class="file-input" accept=".json">
            </div>
        </header>

        <div class="kanban-board" id="kanbanBoard">
            <!-- Colunas ser√£o adicionadas aqui dinamicamente -->
        </div>

        <div class="add-column-btn" id="addColumnBtn">
            <span>‚ûï</span> Adicionar Nova Coluna
        </div>
    </div>

    <!-- Modal para adicionar/editar coluna -->
    <div class="modal" id="columnModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="columnModalTitle">Adicionar Coluna</h2>
                <button class="close-modal">&times;</button>
            </div>
            <form id="columnForm">
                <div class="form-group">
                    <label for="columnTitle">T√≠tulo da Coluna</label>
                    <input type="text" id="columnTitle" required placeholder="Ex: Para Fazer">
                </div>
                <div class="form-group">
                    <label for="columnEmoji">Emoji</label>
                    <input type="text" id="columnEmoji" placeholder="Ex: üìù" maxlength="2">
                    <div class="emoji-selector">
                        <span class="emoji-option" data-emoji="üìù">üìù</span>
                        <span class="emoji-option" data-emoji="üìã">üìã</span>
                        <span class="emoji-option" data-emoji="‚úÖ">‚úÖ</span>
                        <span class="emoji-option" data-emoji="üöÄ">üöÄ</span>
                        <span class="emoji-option" data-emoji="üîß">üîß</span>
                        <span class="emoji-option" data-emoji="üéØ">üéØ</span>
                        <span class="emoji-option" data-emoji="üìä">üìä</span>
                        <span class="emoji-option" data-emoji="üí°">üí°</span>
                    </div>
                </div>
                <div class="form-group">
                    <label for="columnColor">Cor da Coluna</label>
                    <div class="color-picker">
                        <input type="color" id="columnColor" value="#3498db">
                        <span id="columnColorValue">#3498db</span>
                    </div>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn-primary">Salvar Coluna</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para adicionar/editar card -->
    <div class="modal" id="cardModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="cardModalTitle">Adicionar Card</h2>
                <button class="close-modal">&times;</button>
            </div>
            <form id="cardForm">
                <div class="form-group">
                    <label for="cardTitle">T√≠tulo do Card</label>
                    <input type="text" id="cardTitle" required placeholder="Ex: Implementar funcionalidade X">
                </div>
                <div class="form-group">
                    <label for="cardContent">Descri√ß√£o</label>
                    <textarea id="cardContent" placeholder="Descreva os detalhes da tarefa..."></textarea>
                </div>
                <div class="form-group">
                    <label for="cardEmoji">Emoji</label>
                    <input type="text" id="cardEmoji" placeholder="Ex: üî•" maxlength="2">
                    <div class="emoji-selector">
                        <span class="emoji-option" data-emoji="üî•">üî•</span>
                        <span class="emoji-option" data-emoji="‚≠ê">‚≠ê</span>
                        <span class="emoji-option" data-emoji="üíé">üíé</span>
                        <span class="emoji-option" data-emoji="üö©">üö©</span>
                        <span class="emoji-option" data-emoji="üìå">üìå</span>
                        <span class="emoji-option" data-emoji="üîî">üîî</span>
                        <span class="emoji-option" data-emoji="üí¨">üí¨</span>
                        <span class="emoji-option" data-emoji="üìé">üìé</span>
                    </div>
                </div>
                <div class="form-group">
                    <label for="cardColor">Cor do Card</label>
                    <div class="color-picker">
                        <input type="color" id="cardColor" value="#ffffff">
                        <span id="cardColorValue">#ffffff</span>
                    </div>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn-primary">Salvar Card</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Estado do aplicativo
        const state = {
            columns: [],
            currentColumnId: null,
            currentCardId: null,
            editingColumn: false,
            editingCard: false
        };

        // Elementos DOM
        const kanbanBoard = document.getElementById('kanbanBoard');
        const addColumnBtn = document.getElementById('addColumnBtn');
        const columnModal = document.getElementById('columnModal');
        const cardModal = document.getElementById('cardModal');
        const columnForm = document.getElementById('columnForm');
        const cardForm = document.getElementById('cardForm');
        const exportBtn = document.getElementById('exportBtn');
        const importBtn = document.getElementById('importBtn');
        const fileInput = document.getElementById('fileInput');

        // Inicializar aplicativo
        document.addEventListener('DOMContentLoaded', initApp);

        function initApp() {
            // Configurar event listeners
            addColumnBtn.addEventListener('click', () => openColumnModal());
            columnForm.addEventListener('submit', saveColumn);
            cardForm.addEventListener('submit', saveCard);
            exportBtn.addEventListener('click', exportToJSON);
            importBtn.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', importFromJSON);

            // Fechar modais
            document.querySelectorAll('.close-modal').forEach(button => {
                button.addEventListener('click', closeModals);
            });

            // Fechar modais ao clicar fora
            window.addEventListener('click', (e) => {
                if (e.target === columnModal || e.target === cardModal) {
                    closeModals();
                }
            });

            // Configurar seletores de emoji
            setupEmojiSelectors();
            
            // Configurar seletores de cor
            setupColorPickers();

            // Carregar dados salvos
            const savedData = localStorage.getItem('kanbanData');
            if (savedData) {
                try {
                    const parsedData = JSON.parse(savedData);
                    state.columns = parsedData.columns || [];
                } catch (error) {
                    console.error('Erro ao carregar dados:', error);
                    createDefaultColumns();
                }
            } else {
                createDefaultColumns();
            }

            renderBoard();
        }

        function createDefaultColumns() {
            state.columns = [
                {
                    id: generateId(),
                    title: 'Para Fazer',
                    emoji: 'üìù',
                    color: '#3498db',
                    cards: [
                        { 
                            id: generateId(), 
                            title: 'Bem-vindo ao Kanban!', 
                            content: 'Arraste este card entre as colunas para testar o recurso de drag & drop.', 
                            emoji: 'üëã', 
                            color: '#ffffff' 
                        }
                    ]
                },
                {
                    id: generateId(),
                    title: 'Em Progresso',
                    emoji: 'üîß',
                    color: '#f39c12',
                    cards: []
                },
                {
                    id: generateId(),
                    title: 'Conclu√≠do',
                    emoji: '‚úÖ',
                    color: '#2ecc71',
                    cards: []
                }
            ];
            saveToLocalStorage();
        }

        function renderBoard() {
            kanbanBoard.innerHTML = '';
            
            if (state.columns.length === 0) {
                const emptyState = document.createElement('div');
                emptyState.className = 'empty-state';
                emptyState.innerHTML = `
                    <div>üìã</div>
                    <h3>Nenhuma coluna criada</h3>
                    <p>Clique no bot√£o abaixo para adicionar sua primeira coluna!</p>
                `;
                kanbanBoard.appendChild(emptyState);
                return;
            }
            
            state.columns.forEach(column => {
                const columnElement = createColumnElement(column);
                kanbanBoard.appendChild(columnElement);
            });
        }

        function createColumnElement(column) {
            const columnElement = document.createElement('div');
            columnElement.className = 'column';
            columnElement.dataset.columnId = column.id;
            
            // Cabe√ßalho da coluna
            const columnHeader = document.createElement('div');
            columnHeader.className = 'column-header';
            columnHeader.style.background = `linear-gradient(135deg, ${column.color}, ${darkenColor(column.color, 20)})`;
            
            const columnTitle = document.createElement('div');
            columnTitle.className = 'column-title';
            columnTitle.innerHTML = `${column.emoji} ${column.title}`;
            
            const columnActions = document.createElement('div');
            columnActions.className = 'column-actions';
            
            const editButton = document.createElement('button');
            editButton.className = 'btn-primary';
            editButton.innerHTML = '‚úèÔ∏è Editar';
            editButton.addEventListener('click', (e) => {
                e.stopPropagation();
                openColumnModal(column.id);
            });
            
            const deleteButton = document.createElement('button');
            deleteButton.className = 'btn-danger';
            deleteButton.innerHTML = 'üóëÔ∏è Remover';
            deleteButton.addEventListener('click', (e) => {
                e.stopPropagation();
                deleteColumn(column.id);
            });
            
            columnActions.appendChild(editButton);
            columnActions.appendChild(deleteButton);
            columnHeader.appendChild(columnTitle);
            columnHeader.appendChild(columnActions);
            
            // Container de cards
            const cardsContainer = document.createElement('div');
            cardsContainer.className = 'cards-container';
            cardsContainer.dataset.columnId = column.id;
            
            // Eventos de drag and drop
            cardsContainer.addEventListener('dragover', handleDragOver);
            cardsContainer.addEventListener('dragleave', handleDragLeave);
            cardsContainer.addEventListener('drop', handleDrop);
            
            // Adicionar cards
            if (column.cards.length === 0) {
                const emptyState = document.createElement('div');
                emptyState.className = 'empty-state';
                emptyState.innerHTML = `
                    <div>üìÑ</div>
                    <p>Nenhum card nesta coluna</p>
                `;
                cardsContainer.appendChild(emptyState);
            } else {
                column.cards.forEach(card => {
                    const cardElement = createCardElement(card, column.id);
                    cardsContainer.appendChild(cardElement);
                });
            }
            
            // Bot√£o para adicionar card
            const addCardButton = document.createElement('div');
            addCardButton.className = 'add-card-btn';
            addCardButton.innerHTML = '+ Adicionar Card';
            addCardButton.addEventListener('click', () => openCardModal(column.id));
            
            columnElement.appendChild(columnHeader);
            columnElement.appendChild(cardsContainer);
            columnElement.appendChild(addCardButton);
            
            return columnElement;
        }

        function createCardElement(card, columnId) {
            const cardElement = document.createElement('div');
            cardElement.className = 'card';
            cardElement.draggable = true;
            cardElement.dataset.cardId = card.id;
            cardElement.dataset.columnId = columnId;
            cardElement.style.backgroundColor = card.color;
            cardElement.style.borderLeftColor = darkenColor(card.color, 30);
            
            // Eventos de drag and drop
            cardElement.addEventListener('dragstart', handleDragStart);
            cardElement.addEventListener('dragend', handleDragEnd);
            
            // Cabe√ßalho do card
            const cardHeader = document.createElement('div');
            cardHeader.className = 'card-header';
            
            const cardTitle = document.createElement('div');
            cardTitle.className = 'card-title';
            cardTitle.innerHTML = `${card.emoji} ${card.title}`;
            
            const cardActions = document.createElement('div');
            cardActions.className = 'card-actions';
            
            const editButton = document.createElement('button');
            editButton.className = 'btn-primary';
            editButton.innerHTML = '‚úèÔ∏è';
            editButton.title = 'Editar card';
            editButton.addEventListener('click', (e) => {
                e.stopPropagation();
                openCardModal(columnId, card.id);
            });
            
            const deleteButton = document.createElement('button');
            deleteButton.className = 'btn-danger';
            deleteButton.innerHTML = 'üóëÔ∏è';
            deleteButton.title = 'Excluir card';
            deleteButton.addEventListener('click', (e) => {
                e.stopPropagation();
                deleteCard(columnId, card.id);
            });
            
            cardActions.appendChild(editButton);
            cardActions.appendChild(deleteButton);
            cardHeader.appendChild(cardTitle);
            cardHeader.appendChild(cardActions);
            
            // Conte√∫do do card
            const cardContent = document.createElement('div');
            cardContent.className = 'card-content';
            cardContent.textContent = card.content;
            
            cardElement.appendChild(cardHeader);
            cardElement.appendChild(cardContent);
            
            return cardElement;
        }

        // DRAG AND DROP
        let draggedCard = null;

        function handleDragStart(e) {
            draggedCard = this;
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/plain', this.dataset.cardId);
        }

        function handleDragEnd() {
            this.classList.remove('dragging');
            document.querySelectorAll('.cards-container').forEach(container => {
                container.classList.remove('drag-over');
            });
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            this.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            if (!this.contains(e.relatedTarget)) {
                this.classList.remove('drag-over');
            }
        }

        function handleDrop(e) {
            e.preventDefault();
            this.classList.remove('drag-over');
            
            if (!draggedCard) return;
            
            const cardId = draggedCard.dataset.cardId;
            const sourceColumnId = draggedCard.dataset.columnId;
            const targetColumnId = this.dataset.columnId;
            
            if (sourceColumnId !== targetColumnId) {
                moveCardBetweenColumns(cardId, sourceColumnId, targetColumnId);
            }
        }

        function moveCardBetweenColumns(cardId, sourceColumnId, targetColumnId) {
            const sourceColumn = state.columns.find(col => col.id === sourceColumnId);
            const targetColumn = state.columns.find(col => col.id === targetColumnId);
            
            if (!sourceColumn || !targetColumn) return;
            
            const cardIndex = sourceColumn.cards.findIndex(card => card.id === cardId);
            if (cardIndex === -1) return;
            
            const card = sourceColumn.cards[cardIndex];
            sourceColumn.cards.splice(cardIndex, 1);
            targetColumn.cards.push(card);
            
            saveToLocalStorage();
            renderBoard();
        }

        // MODAIS
        function openColumnModal(columnId = null) {
            const modalTitle = document.getElementById('columnModalTitle');
            const titleInput = document.getElementById('columnTitle');
            const emojiInput = document.getElementById('columnEmoji');
            const colorInput = document.getElementById('columnColor');
            
            if (columnId) {
                state.editingColumn = true;
                state.currentColumnId = columnId;
                modalTitle.textContent = 'Editar Coluna';
                
                const column = state.columns.find(col => col.id === columnId);
                if (column) {
                    titleInput.value = column.title;
                    emojiInput.value = column.emoji;
                    colorInput.value = column.color;
                    document.getElementById('columnColorValue').textContent = column.color;
                }
            } else {
                state.editingColumn = false;
                modalTitle.textContent = 'Adicionar Coluna';
                titleInput.value = '';
                emojiInput.value = '';
                colorInput.value = '#3498db';
                document.getElementById('columnColorValue').textContent = '#3498db';
            }
            
            columnModal.style.display = 'flex';
            titleInput.focus();
        }

        function openCardModal(columnId, cardId = null) {
            const modalTitle = document.getElementById('cardModalTitle');
            const titleInput = document.getElementById('cardTitle');
            const contentInput = document.getElementById('cardContent');
            const emojiInput = document.getElementById('cardEmoji');
            const colorInput = document.getElementById('cardColor');
            
            state.currentColumnId = columnId;
            
            if (cardId) {
                state.editingCard = true;
                state.currentCardId = cardId;
                modalTitle.textContent = 'Editar Card';
                
                const column = state.columns.find(col => col.id === columnId);
                if (column) {
                    const card = column.cards.find(c => c.id === cardId);
                    if (card) {
                        titleInput.value = card.title;
                        contentInput.value = card.content;
                        emojiInput.value = card.emoji;
                        colorInput.value = card.color;
                        document.getElementById('cardColorValue').textContent = card.color;
                    }
                }
            } else {
                state.editingCard = false;
                modalTitle.textContent = 'Adicionar Card';
                titleInput.value = '';
                contentInput.value = '';
                emojiInput.value = '';
                colorInput.value = '#ffffff';
                document.getElementById('cardColorValue').textContent = '#ffffff';
            }
            
            cardModal.style.display = 'flex';
            titleInput.focus();
        }

        function closeModals() {
            columnModal.style.display = 'none';
            cardModal.style.display = 'none';
        }

        function saveColumn(e) {
            e.preventDefault();
            
            const title = document.getElementById('columnTitle').value.trim();
            const emoji = document.getElementById('columnEmoji').value.trim() || 'üìã';
            const color = document.getElementById('columnColor').value;
            
            if (!title) {
                alert('Por favor, insira um t√≠tulo para a coluna.');
                return;
            }
            
            if (state.editingColumn) {
                const column = state.columns.find(col => col.id === state.currentColumnId);
                if (column) {
                    column.title = title;
                    column.emoji = emoji;
                    column.color = color;
                }
            } else {
                const newColumn = {
                    id: generateId(),
                    title,
                    emoji,
                    color,
                    cards: []
                };
                state.columns.push(newColumn);
            }
            
            saveToLocalStorage();
            renderBoard();
            closeModals();
        }

        function saveCard(e) {
            e.preventDefault();
            
            const title = document.getElementById('cardTitle').value.trim();
            const content = document.getElementById('cardContent').value.trim();
            const emoji = document.getElementById('cardEmoji').value.trim() || 'üìÑ';
            const color = document.getElementById('cardColor').value;
            
            if (!title) {
                alert('Por favor, insira um t√≠tulo para o card.');
                return;
            }
            
            const column = state.columns.find(col => col.id === state.currentColumnId);
            if (!column) return;
            
            if (state.editingCard) {
                const card = column.cards.find(card => card.id === state.currentCardId);
                if (card) {
                    card.title = title;
                    card.content = content;
                    card.emoji = emoji;
                    card.color = color;
                }
            } else {
                const newCard = {
                    id: generateId(),
                    title,
                    content,
                    emoji,
                    color
                };
                column.cards.push(newCard);
            }
            
            saveToLocalStorage();
            renderBoard();
            closeModals();
        }

        function deleteColumn(columnId) {
            if (confirm('Tem certeza que deseja excluir esta coluna? Todos os cards ser√£o removidos.')) {
                state.columns = state.columns.filter(col => col.id !== columnId);
                saveToLocalStorage();
                renderBoard();
            }
        }

        function deleteCard(columnId, cardId) {
            if (confirm('Tem certeza que deseja excluir este card?')) {
                const column = state.columns.find(col => col.id === columnId);
                if (column) {
                    column.cards = column.cards.filter(card => card.id !== cardId);
                    saveToLocalStorage();
                    renderBoard();
                }
            }
        }

        // UTILIT√ÅRIOS
        function setupEmojiSelectors() {
            document.querySelectorAll('.emoji-option').forEach(option => {
                option.addEventListener('click', function() {
                    const emoji = this.getAttribute('data-emoji');
                    const modal = this.closest('.modal-content');
                    const emojiInput = modal.querySelector('input[type="text"]');
                    emojiInput.value = emoji;
                });
            });
        }

        function setupColorPickers() {
            const columnColorInput = document.getElementById('columnColor');
            const columnColorValue = document.getElementById('columnColorValue');
            
            columnColorInput.addEventListener('input', function() {
                columnColorValue.textContent = this.value;
            });
            
            const cardColorInput = document.getElementById('cardColor');
            const cardColorValue = document.getElementById('cardColorValue');
            
            cardColorInput.addEventListener('input', function() {
                cardColorValue.textContent = this.value;
            });
        }

        function exportToJSON() {
            const dataStr = JSON.stringify({ columns: state.columns }, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', 'kanban-board.json');
            linkElement.click();
        }

        function importFromJSON(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    if (importedData && Array.isArray(importedData.columns)) {
                        state.columns = importedData.columns;
                        saveToLocalStorage();
                        renderBoard();
                        alert('Dados importados com sucesso!');
                    } else {
                        alert('Arquivo JSON inv√°lido.');
                    }
                } catch (error) {
                    alert('Erro ao importar arquivo. Certifique-se de que √© um arquivo JSON v√°lido.');
                }
            };
            reader.readAsText(file);
            e.target.value = '';
        }

        function saveToLocalStorage() {
            localStorage.setItem('kanbanData', JSON.stringify(state));
        }

        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function darkenColor(color, percent) {
            const num = parseInt(color.replace("#", ""), 16);
            const amt = Math.round(2.55 * percent);
            const R = (num >> 16) - amt;
            const G = (num >> 8 & 0x00FF) - amt;
            const B = (num & 0x0000FF) - amt;
            return "#" + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
                (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
                (B < 255 ? B < 1 ? 0 : B : 255)).toString(16).slice(1);
        }
    </script>
</body>
</html>
